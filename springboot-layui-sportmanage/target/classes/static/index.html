<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <title>运动会管理系统</title>
    <link rel="stylesheet" href="./layui/css/layui.css">
    <script src="js/jquery-2.1.1.min.js"></script>
    <script src="./js/SessionStorage.js"></script>
</head>
<body>
<div class="layui-layout layui-layout-admin">
    <div class="layui-header">
        <div class="layui-logo layui-hide-xs layui-bg-black">运动会管理系统</div>
        <!-- 头部区域（可配合layui 已有的水平导航） -->
        <ul class="layui-nav layui-layout-left">
            <!-- 移动端显示 -->
            <li class="layui-nav-item layui-show-xs-inline-block layui-hide-sm" lay-header-event="menuLeft">
                <i class="layui-icon layui-icon-spread-left"></i>
            </li>

            <!--            <li class="layui-nav-item layui-hide-xs"><a href="">nav 1</a></li>-->
            <!--            <li class="layui-nav-item layui-hide-xs"><a href="">nav 2</a></li>-->
            <!--            <li class="layui-nav-item layui-hide-xs"><a href="">nav 3</a></li>-->
            <!--            <li class="layui-nav-item">-->
            <!--                <a href="javascript:;">nav groups</a>-->
            <!--                <dl class="layui-nav-child">-->
            <!--                    <dd><a href="">menu 11</a></dd>-->
            <!--                    <dd><a href="">menu 22</a></dd>-->
            <!--                    <dd><a href="">menu 33</a></dd>-->
            <!--                </dl>-->
            <!--            </li>-->
        </ul>
        <ul class="layui-nav layui-layout-right">
            <li class="layui-nav-item" id="time" style="margin-right: 50px;font-size: 20px;color: #2fb9d4;font-family: 'yjsz'"></li>
            <li class="layui-nav-item layui-hide layui-show-md-inline-block">
                <a href="javascript:;">
                    <img src="./img/06.jpg" class="layui-nav-img">
                    <span id="name">admin</span>

                </a>
                <dl class="layui-nav-child">
                    <dd class="daohang" mytitle="修改头像" data-url="./image-age.html"><a href="javascript:">修改头像</a></dd>
                    <dd class="daohang" mytitle="修改密码" data-url="./updatePwd.html"><a href="javascript:">修改密码</a></dd>
                    <dd><a href="#" id="loginout">退出登录</a></dd>
                </dl>
            </li>
            <li class="layui-nav-item" lay-header-event="menuRight" lay-unselect>
                <a href="javascript:;">
                    <i class="layui-icon layui-icon-more-vertical"></i>
                </a>
            </li>
        </ul>
    </div>

    <div class="layui-side layui-bg-black" style="left:0px; overflow:hidden;">
        <div style="height: 130px; padding:20px;">
            <a class="img" class="mainphoto" title="我的头像" style="display: block;width: 80px;height: 80px;margin: 10px auto 10px;">
                <img src="./img/06.jpg" class="userAvatar" style="display: block;width: 100%;height: 100%;border-radius: 50%;-webkit-border-radius: 50%;-moz-border-radius: 50%;border: 4px solid #44576b;box-sizing: border-box;">
            </a>
            <p style=" display: block;width: 100%;height: 25px;color: #ffffff;text-align: center;font-size: 12px;white-space: nowrap;line-height: 25px;overflow: hidden;">
                你好！<span class="userName">admin</span>, 欢迎回来
            </p>
        </div>
        <div class="layui-side-scroll">
            <!-- 左侧导航区域（可配合layui已有的垂直导航） -->

            <ul class="layui-nav layui-nav-tree site-demo-nav" lay-filter="side">
                <!--                <li class="layui-nav-item layui-nav-itemed">-->
                <!--                    <a class="" href="javascript:;">menu group 1</a>-->
                <!--                    <dl class="layui-nav-child">-->
                <!--                        <dd><a href="javascript:;">menu 1</a></dd>-->
                <!--                        <dd><a href="javascript:;">menu 2</a></dd>-->
                <!--                        <dd><a href="javascript:;">menu 3</a></dd>-->
                <!--                        <dd><a href="">the links</a></dd>-->
                <!--                    </dl>-->
                <!--                </li>-->
                <!--                <li class="layui-nav-item">-->
                <!--                    <a href="javascript:;">menu group 2</a>-->
                <!--                    <dl class="layui-nav-child">-->
                <!--                        <dd><a href="javascript:;">list 1</a></dd>-->
                <!--                        <dd><a href="javascript:;">list 2</a></dd>-->
                <!--                        <dd><a href="">超链接</a></dd>-->
                <!--                    </dl>-->
                <!--                </li>-->
                <li class="layui-nav-item daohang" mytitle="运动员管理" data-url="./athlete-list.html"><a href="javascript:;" >运动员列表</a></li>
                <li class="layui-nav-item daohang" mytitle="比赛项目管理" data-url="./match-list.html"><a href="javascript:">项目列表</a></li>
                <li class="layui-nav-item daohang" mytitle="参赛和成绩管理" data-url="./entry-list.html"><a href="javascript:">参数和成绩列表</a></li>
            </ul>
        </div>
    </div>

    <div class="layui-body">
        <!-- 内容主体区域 -->
        <div style="padding: 15px;">
            <div class="layui-tab layui-tab-card site-demo-title x-main" lay-filter="x-tab" lay-allowclose="true" style="left: 220px;border-left: solid 2px #2299ee;">
                <ul class="layui-tab-title">
                    <li class="layui-this"> 我的桌面 <i class="layui-icon layui-unselect layui-tab-close">ဆ</i> </li>
                </ul>
                <div class="layui-tab-content">
                    <div class="layui-tab-item layui-show " >
                        <iframe frameborder="0" src="./welcome.html"  style="width: 100%" id="myiframe" scrolling="no" onload="changeFrameHeight()" frameborder="0"></iframe>
                    </div>
<!--                    <blockquote class="layui-elem-quote">-->
<!--                        <sapn>admin</sapn>欢迎使用运动会管理系统！-->
<!--                    </blockquote>-->
<!--                    <div id="pic" style="text-align: center">-->
<!--                    <img src="./img/欢迎图标.png" alt="">-->
<!--                    </div>-->

                </div>


            </div>
        </div>
    </div>

<!--    <div class="layui-footer" style="background-color: #2fb9d4 ;text-align:center">-->
<!--        &lt;!&ndash; 底部固定区域 &ndash;&gt;-->
<!--        <span>底部固定区域</span>-->
<!--    </div>-->
</div>
<script src="./layui/layui.js"></script>
<script>
    //JS
    layui.use(['element', 'layer', 'util'], function(){
        var element = layui.element
            ,layer = layui.layer
            ,util = layui.util
            ,$ = layui.$;

        //头部事件
        util.event('lay-header-event', {
            //左侧菜单事件
            menuLeft: function(othis){
                layer.msg('展开左侧菜单的操作', {icon: 0});
            }
            ,menuRight: function(){
                layer.open({
                    type: 1
                    ,content: '<div style="padding: 15px;">处理右侧面板的操作</div>'
                    ,area: ['260px', '100%']
                    ,offset: 'rt' //右上角
                    ,anim: 5
                    ,shadeClose: true
                });
            }
        });
        var active = {
            tabAdd: function(){
                //新增一个Tab项
                var htmlurl=$(this).attr('data-url');
                var mytitle=$(this).attr('mytitle');
                var arrayObj = new Array();　//创建一个数组
                $(".layui-tab-title").find('li').each(function() {
                    var y = $(this).attr("lay-id");
                    arrayObj.push(y);
                });
//                    alert("遍历取到的数组："+arrayObj);
                var have=$.inArray(mytitle, arrayObj);  //返回 3,
                if (have>0) {
                    //tab已有标签
//                        alert("遍历的已有标签："+mytitle);
                    element.tabChange('x-tab', mytitle); //切换到当前点击的页面
                } else{
                    //没有相同tab
//                      alert("遍历的没有相同tab："+mytitle);
                    element.tabAdd('x-tab', {
                        title:mytitle //用于演示
                        ,content: '<iframe id="myiframe" name="myiframe"style="width: 100%" frameborder="0" height="722" src='+htmlurl+' ></iframe>'
                            // <iframe frameborder="0" src='+htmlurl'+  id="myiframe" scrolling="no" onload="changeFrameHeight()" frameborder="0"></iframe>
                        ,id: mytitle //实际使用一般是规定好的id，这里以时间戳模拟下
                    })
                    element.tabChange('x-tab', mytitle); //切换到当前点击的页面
                }
            }

        };
        $(".daohang").click(function(){
            var type="tabAdd";
            var othis = $(this);
//                var htmlurl=$(this).attr('data-url');
//                var mytitle=$(this).attr('mytitle');
            active[type] ? active[type].call(this, othis) : '';
        });
        $(document).ready(function () {
            var uid=handleSessionStorage("get","uid")
            var username=handleSessionStorage("get","username");

            if(uid==false&&username==false){
                alert("请先登录");
                location.href = '/loginout';
            }
            $(".userName").text(username);
            $("#name").text(username);
            $.ajax({
                type:"POST",
                url:"/user/showPicture",
                contentType: "application/json; charset=utf-8",
                dataType: "json",//返回的数据类型格式
                data: JSON.stringify({
                    uid:uid
                }),
                success:function (data) {
                    var image =data.image;
                    // console.log(image[0].image);
                    $("img").attr("src", image[0].image);
                    var imagedata=image[0].image;
                    handleSessionStorage("set","imageurl",imagedata);
                },
                error:function (data) {

                }
            });
        })
        $("#loginout").click(function () {
            if (confirm('系统提示，您确定要退出本次登录吗?')) {
                location.href = '/loginout';
                sessionStorage.clear();
            }

        });


    });
    function changeFrameHeight(){
        var ifm= document.getElementById("myiframe");
        ifm.height=document.documentElement.clientHeight;

    }

    window.onresize=function(){
        changeFrameHeight();

    }
    //顶部时间
    function getTime(){
        var myDate = new Date();
        var myYear = myDate.getFullYear(); //获取完整的年份(4位,1970-????)
        var myMonth = myDate.getMonth()+1; //获取当前月份(0-11,0代表1月)
        var myToday = myDate.getDate(); //获取当前日(1-31)
        var myDay = myDate.getDay(); //获取当前星期X(0-6,0代表星期天)
        var myHour = myDate.getHours(); //获取当前小时数(0-23)
        var myMinute = myDate.getMinutes(); //获取当前分钟数(0-59)
        var mySecond = myDate.getSeconds(); //获取当前秒数(0-59)
        var week = ['星期日','星期一','星期二','星期三','星期四','星期五','星期六'];
        var nowTime;

        nowTime = myYear+'-'+fillZero(myMonth)+'-'+fillZero(myToday)+'&nbsp;&nbsp;'+fillZero(myHour)+':'+fillZero(myMinute)+':'+fillZero(mySecond)+'&nbsp;&nbsp;'+week[myDay]+'&nbsp;&nbsp;';
        //console.log(nowTime);
        $('#time').html(nowTime);
    };
    function fillZero(str){
        var realNum;
        if(str<10){
            realNum	= '0'+str;
        }else{
            realNum	= str;
        }
        return realNum;
    }
    setInterval(getTime,1000);
</script>
</body>
</html>